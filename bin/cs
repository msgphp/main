#!/usr/bin/env bash

VERSION="v2.13.1"
PHAR="var/cache/php-cs-fixer-${VERSION}.phar"

if [[ ! -f ${PHAR} ]] ; then
    mkdir -p $(dirname ${PHAR})
    curl -Lso ${PHAR} https://github.com/FriendsOfPHP/PHP-CS-Fixer/releases/download/${VERSION}/php-cs-fixer.phar
    chmod +x ${PHAR}
fi

if [[ $# -eq 0 ]] ; then
    DIR="src/"
elif [[ -d $1 ]] ; then
    DIR="$1"
    shift;
else
    DIR="src/$(echo $1 | sed -r 's/(^|-)(\w)/\U\2/g')"
    shift;
fi

CMD="${PHAR} fix --dry-run --verbose --diff ${@} ${DIR}"

bash -xc "${CMD}" 2>&1
