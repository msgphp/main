includes:
    - /tools/.composer/vendor-bin/phpstan/vendor/phpstan/phpstan-deprecation-rules/rules.neon
    - /tools/.composer/vendor-bin/phpstan/vendor/phpstan/phpstan-phpunit/extension.neon
    - /tools/.composer/vendor-bin/phpstan/vendor/phpstan/phpstan-phpunit/rules.neon

parameters:
    level: max
    paths:
        - src
        - tests/sa/fixtures
    autoload_directories:
        - tests/sa/fixtures
        - var/phpunit/phpunit-7.5/src
    tmpDir: var/phpstan

    ignoreErrors:
        # phpstan
        - '#Cannot call method getName\(\) on ReflectionClass\|null\.#'
        # https://github.com/phpstan/phpstan-phpunit/issues/43
        -
            message: '''
            #Call to static method PHPUnit\\Framework\\Assert::assertSame\(\) with array\(1, '2'\) and array\(1\) will always evaluate to false\.#
            '''
            path: src/Domain/Tests/GenericDomainCollectionTest.php

        # deprecated
        -
            message: '#Call to deprecated method toString\(\) of class Ramsey\\Uuid\\UuidInterface\.#'
            path: src/Domain/Infra/Uuid/DomainIdTrait.php
        -
            message: '#Call to deprecated method getRoles\(\) of class Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface\.#'
            path: src/User/Infra/Security/DataCollector.php

        # msgphp
        - '#Method MsgPhp\\.+\\Infra\\Doctrine\\Repository\\.+Repository::find.*\(\) should return MsgPhp\\.+\\Entity\\.+ but returns object\.#'
        - '#Parameter \#1 \$command of method MsgPhp\\.+\\Command\\Handler\\.+Handler::getDomainEvent(Target)?\(\) expects MsgPhp\\.+\\Command\\.+Command, object given\.#'
        - '#Return type \(MsgPhp\\Domain\\Infra\\Config\\ClassMappingNode\) of method MsgPhp\\Domain\\Infra\\Config\\ClassMappingNodeDefinition::instantiateNode\(\) should be compatible with return type \(Symfony\\Component\\Config\\Definition\\VariableNode\) of method Symfony\\Component\\Config\\Definition\\Builder\\VariableNodeDefinition::instantiateNode\(\)#'
        - '#Cannot call method classMappingNode\(\) on Symfony\\Component\\Config\\Definition\\Builder\\NodeParentInterface\|null\.#'
        - '#Method MsgPhp\\Domain\\Infra\\Elasticsearch\\ProjectionTypeRegistry::all\(\) should return array<string> but returns array<int\|string>.#'
        - '#Property MsgPhp\\Domain\\Infra\\Elasticsearch\\ProjectionTypeRegistry::\$types \(array<string>\|null\) does not accept array<int, int\|string>.#'

        # msgphp tests
        - '#Class MsgPhp\\Domain\\Tests\\Factory\\TestUnknownObject not found\.#'
        - '#Constructor of class MsgPhp\\Domain\\Tests\\Factory\\TestKnownObject has an unused parameter \$arg\.#'
        - '#Parameter \$arg of method MsgPhp\\Domain\\Tests\\Factory\\TestKnownObject::__construct\(\) has invalid typehint type MsgPhp\\Domain\\Tests\\Factory\\TestUnknownObject\.#'
        - '#Class MsgPhp\\Domain\\Tests\\Factory\\TestClassWrongCase referenced with incorrect case: MsgPhp\\Domain\\Tests\\Factory\\testclasswrongcase\.#'
        - '#Static property MsgPhp\\.+\\Tests\\.+Test::\$em \(Doctrine\\ORM\\EntityManagerInterface\) does not accept null\.#'
        - '#Static property MsgPhp\\.+\\Tests\\.+Test::\$bus \(Symfony\\Component\\Messenger\\MessageBusInterface\) does not accept null\.#'
        -
            message: '#Call to an undefined method object::.+\(\)\.#'
            path: *src/*/Tests/Model/*Test.php
        -
            message: '#Call to an undefined method object::dispatch\(\)\.#'
            path: src/Domain/Tests/Message/MessageDispatchingTraitTest.php

    excludes_analyse:
        - */src/*/vendor/*
        - src/UserBundle/Resources/skeleton
        - src/UserBundle/Maker/UserMaker.php

services:
	-
		class: MsgPhp\SA\PHPStan\DomainObjectFactoryTypeExtension
		tags:
			- phpstan.broker.dynamicMethodReturnTypeExtension
